<html>
<head>
<title>Server</title>
<meta charset="utf-8" />
<script type="text/javascript">
	// general variables
	var ws;
	var array = [];
	// start method load on startups
	function start() {
		// preparing ws
		ws = new WebSocket('ws://localhost:8080/test/main');
		// prepare media
		navigator.getUserMedia = navigator.getUserMedia
				|| navigator.webkitGetUserMedia || navigator.mozGetUserMedia;
		// reading media
		navigator.getUserMedia({video:false,audio:true},read,error);
	}

	function read(stream) {
		// read from current source
		/*var audio = document.querySelector('audio');
		audio.srcObject = stream;// to use stream
		audio.onloadedmetadata = function(e) {
			audio.play();
		};*/
		// read from another source
		const recorder = new MediaRecorder(stream,{mimeType: "audio/ogg"});
		recorder.ondataavailable = e => {
			array.push(e.data);
			play();
		};
		recorder.start(1000);
	}

	function error(e) {
		console.log(e);
	}
	
	function play(){
		var blob = new Blob(array,{mimeType:"audio/ogg"});
		var url = URL.createObjectURL(blob);
		
		var audio = document.querySelector("audio");
		audio.src = url;
	}
	
	function audioEnd(audio){
		audio.pause();
	}
	
	function loadedData(audio){
		
	}
</script>
</head>
<body onload="start()">
	<h1>server</h1>
	<audio autoplay="autoplay" onend="audioEnd(this)" onloadeddata="loadedData()"></audio>
</body>
</html>
