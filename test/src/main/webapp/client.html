<html>
<head>
<title>client</title>
<meta charset="utf-8" />
<!-- performance also be up to date -->
<meta http-equiv="refresh" content="1">
<script type="text/javascript">
	// general variables
	var ws ;
	var isSetCurrentTime = false;
	var currentTime = 0;
	var blobTimeDuration = 5;
	var array = [];
	var audio;
	// general functions
	async function play(e){
		while(array.length > 1){
			array.pop();
		}
		array.push(e)
		var blob = new Blob(array,{mimeType:"audio/ogg"});
		var url = URL.createObjectURL(blob);

		if(!isSetCurrentTime){
			currentTime = audio.currentTime;
		}else{
			isSetCurrentTime = false;
		}
		audio.src = url;
	}
	
	function loadNewMusic(){
		if(audio.duration > currentTime){
			audio.currentTime = currentTime;
		}else{
			audio.currentTime = 0;
		}
		if(audio.paused){
			audio.play();
		}
	}
	
	function finishAudio(){
		currentTime = audio.duration;
		isSetCurrentTime = true;
	}
	//start method is called on startup
	function start() {
		ws = new WebSocket('ws://localhost:8080/test/main');
		audio = document.querySelector("audio");
		// handle events
		ws.onopen = function() {
			console.log("open")
		};

		ws.onmessage = function(e){
			if(typeof e.data === "string"){
				currentTime = Number(e.data)*blobTimeDuration;
				isSetCurrentTime = true;
			}else{
				play(e.data);
			}
		};

		ws.onclose = function() {
			console.log("closed");
		};
	}
</script>
</head>
<body onload="start()">
	<h1>client</h1>
	<audio onended="finishAudio()" onloadedmetadata="loadNewMusic()" controls="controls"></audio>
</body>
</html>